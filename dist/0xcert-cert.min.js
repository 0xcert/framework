!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=63)}({12:function(e,t){e.exports=void 0},55:function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(56)),i(n(57)),i(n(58)),i(n(59)),i(n(60)),i(n(61))},56:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function u(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,u)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.sha=function(e,t){return i(this,void 0,void 0,function*(){if("undefined"!=typeof window){const n=new window.TextEncoder("utf-8").encode(t),i=yield window.crypto.subtle.digest(`SHA-${e}`,n);return Array.from(new Uint8Array(i)).map(e=>("00"+e.toString(16)).slice(-2)).join("")}return n(12).createHash(`sha${e}`).update(t).digest("hex")})}},57:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toFloat=function(e){return parseFloat(`${e}`)||0}},58:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toInteger=function(e){return parseInt(`${e}`)||0}},59:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toSeconds=function(e){return parseInt(`${parseFloat(`${e}`)/1e3}`)||0}},60:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toString=function(e){return null!=e?e.toString():null}},61:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toTuple=function e(t){if(!(t instanceof Object))return[];var n=[],i=0;return Object.keys(t).forEach(r=>{if(t[r]instanceof Object)n[i]=e(t[r]);else if(t[r]instanceof Array){let o=0,s=[];t[r].forEach(n=>{s[o]=e(t[r]),o++}),n[i]=s}else n[i]=t[r];i++}),n}},63:function(e,t,n){window.$0xcert=window.$0xcert||{},Object.assign(window.$0xcert,n(64))},64:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(65))},65:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function u(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,u)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(55),o=n(66),s=n(68);t.Cert=class{constructor(e){this.schema=e.schema,this.merkle=new o.Merkle(Object.assign({hasher:e=>r.sha(256,s.toString(e))},e))}notarize(e){return i(this,void 0,void 0,function*(){const t=this.buildSchemaProps(e),n=yield this.buildCompoundProps(t);return(yield this.buildProofs(n)).map(e=>({path:e.path,nodes:e.nodes,values:e.values}))})}disclose(e,t){return i(this,void 0,void 0,function*(){const n=this.buildSchemaProps(e),i=yield this.buildCompoundProps(n);return(yield this.buildProofs(i,t)).map(e=>({path:e.path,nodes:e.nodes,values:e.values}))})}calculate(e,t){return i(this,void 0,void 0,function*(){try{return this.checkDataInclusion(e,t)?this.imprintProofs(t):null}catch(e){return null}})}imprint(e){return i(this,void 0,void 0,function*(){return this.notarize(e).then(e=>e[0].nodes[0].hash)})}buildSchemaProps(e,t=this.schema,n=[]){return"array"===t.type?(e||[]).map((e,i)=>this.buildSchemaProps(e,t.items,[...n,i])).reduce((e,t)=>e.concat(t),[]):"object"===t.type?Object.keys(t.properties).sort().map(i=>{const r=this.buildSchemaProps((e||{})[i],t.properties[i],[...n,i]);return-1===["object","array"].indexOf(t.properties[i].type)?[r]:r}).reduce((e,t)=>e.concat(t),[]):{path:n,value:e,key:n.join("."),group:n.slice(0,-1).join(".")}}buildCompoundProps(e){return i(this,void 0,void 0,function*(){e=[...e];const t=this.buildPropGroups(e),n=Object.keys(t).sort((e,t)=>e>t?-1:1).filter(e=>""!==e);for(const i of n){const n=t[i],r=[...e.filter(e=>e.group===i)].sort((e,t)=>e.key>t.key?1:-1).map(e=>e.value),o=yield this.merkle.notarize(r);e.push({path:n,value:o.nodes[0].hash,key:n.join("."),group:n.slice(0,-1).join(".")})}return e.sort((e,t)=>e.key>t.key?1:-1)})}buildProofs(e,t=null){return i(this,void 0,void 0,function*(){const n=t?s.stepPaths(t).map(e=>e.join(".")):null,r={};return e.forEach(e=>r[e.group]=e.path.slice(0,-1)),Promise.all(Object.keys(r).map(t=>i(this,void 0,void 0,function*(){const i=e.filter(e=>e.group===t).map(e=>e.value);let o=yield this.merkle.notarize(i);if(n){const i=e.filter(e=>e.group===t).map((e,t)=>-1===n.indexOf(e.key)?-1:t).filter(e=>-1!==e);o=yield this.merkle.disclose(o,i)}if(!n||-1!==n.indexOf(r[t].join(".")))return{path:r[t],values:o.values,nodes:o.nodes,key:r[t].join("."),group:r[t].slice(0,-1).join(".")}}))).then(e=>e.filter(e=>!!e))})}checkDataInclusion(e,t){const n=this.buildSchemaProps(e);t=s.cloneObject(t).map(e=>Object.assign({key:e.path.join("."),group:e.path.slice(0,-1).join(".")},e));for(const i of n){const n=s.readPath(i.path,e);if(void 0===n)continue;const r=i.path.slice(0,-1).join("."),o=t.find(e=>e.key===r);if(!o)return!1;const u=this.getPathIndexes(i.path).pop();if(o.values.find(e=>e.index===u).value!==n)return!1}return!0}imprintProofs(e){return i(this,void 0,void 0,function*(){if(0===e.length)return this.getEmptyImprint();e=s.cloneObject(e).map(e=>Object.assign({key:e.path.join("."),group:e.path.slice(0,-1).join(".")},e)).sort((e,t)=>e.path.length>t.path.length?-1:1);for(const t of e){const n=yield this.merkle.imprint(t).catch(()=>"");t.nodes.unshift({index:0,hash:n});const i=t.path.slice(0,-1).join("."),r=this.getPathIndexes(t.path).slice(-1).pop(),o=e.find(e=>e.key===i);o&&o.values.unshift({index:r,value:n})}const t=e.find(e=>""===e.key);return t?t.nodes.find(e=>0===e.index).hash:this.getEmptyImprint()})}getPathIndexes(e){const t=[];let n=this.schema;for(const i of e)"array"===n.type?(t.push(i),n=n.items):"object"===n.type?(t.push(Object.keys(n.properties).sort().indexOf(i)),n=n.properties[i]):t.push(void 0);return t}getEmptyImprint(){return i(this,void 0,void 0,function*(){return this.merkle.notarize([]).then(e=>e.nodes[0].hash)})}buildPropGroups(e){const t={};return e.map(e=>{let t=[];return e.path.map(e=>(t.push(e),[...t]))}).reduce((e,t)=>e.concat(t),[]).forEach(e=>t[e.slice(0,-1).join(".")]=e.slice(0,-1)),t}}},66:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(67))},67:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function u(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,u)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});t.Merkle=class{constructor(e){this.config=Object.assign({hasher:e=>e},e)}notarize(e){return i(this,void 0,void 0,function*(){const t=[...e],n=[yield this.config.hasher("")];for(let e=t.length-1;e>=0;e--){const i=n[0],r=t[e];n.unshift(yield this.config.hasher(r));const o=n[0];n.unshift(yield this.config.hasher(`${o}${i}`))}return{values:t.map((e,t)=>({index:t,value:e})),nodes:n.map((e,t)=>({index:t,hash:e}))}})}disclose(e,t){return i(this,void 0,void 0,function*(){const n=Math.max(...t.map(e=>e+1),0),i=[],r=[e.nodes.find(e=>e.index===2*n)];for(let o=n-1;o>=0;o--)-1!==t.indexOf(o)?i.unshift(e.values.find(e=>e.index===o)):r.unshift(e.nodes.find(e=>e.index===2*o+1));return{values:i,nodes:r}})}imprint(e){return i(this,void 0,void 0,function*(){const t=[...yield Promise.all(e.values.map(e=>i(this,void 0,void 0,function*(){return{index:2*e.index+1,hash:yield this.config.hasher(e.value),value:e.value}}))),...e.nodes];for(let e=Math.max(...t.map(e=>e.index+1),0)-1;e>=0;e-=2){const n=t.find(t=>t.index===e),i=t.find(t=>t.index===e-1);n&&i&&t.unshift({index:e-2,hash:yield this.config.hasher(`${i.hash}${n.hash}`)})}const n=t.find(e=>0===e.index);return n?n.hash:null})}}},68:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toString=function(e){try{return null==e?"":`${e}`}catch(e){return""}},t.cloneObject=function(e){return JSON.parse(JSON.stringify(e))},t.stepPaths=function(e){const t={"":[]};return e.forEach(e=>{let n=[];e.forEach(e=>{n.push(e),t[n.join(".")]=[...n]})}),Object.keys(t).sort().map(e=>t[e])},t.readPath=function e(t,n){try{return Array.isArray(t)?0===t.length?n:e(t.slice(1),n[t[0]]):void 0}catch(e){return}}}});