!function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";function a(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),a(n(1)),a(n(2)),a(n(3))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.MANAGE_ABILITIES=0]="MANAGE_ABILITIES",e[e.MINT_ASSET=1]="MINT_ASSET",e[e.REVOKE_ASSET=2]="REVOKE_ASSET",e[e.PAUSE_TRANSFER=3]="PAUSE_TRANSFER",e[e.UPDATE_PROOF=4]="UPDATE_PROOF",e[e.SIGN_MINT_CLAIM=5]="SIGN_MINT_CLAIM"}(t.AssetLedgerAbility||(t.AssetLedgerAbility={})),function(e){e[e.DISABLED=0]="DISABLED",e[e.ENABLED=1]="ENABLED"}(t.AssetLedgerTransferState||(t.AssetLedgerTransferState={})),function(e){e[e.BURNABLE=1]="BURNABLE",e[e.MUTABLE=2]="MUTABLE",e[e.PAUSABLE=3]="PAUSABLE",e[e.REVOKABLE=4]="REVOKABLE"}(t.AssetLedgerCapability||(t.AssetLedgerCapability={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNHANDLED=0]="UNHANDLED",e[e.GENERAL_REVERT=1]="GENERAL_REVERT",e[e.SIGNATURE_UNKNOWN=9e3]="SIGNATURE_UNKNOWN",e[e.SIGNATURE_FAILED=9001]="SIGNATURE_FAILED",e[e.INVALID_MAKER_ID=8e3]="INVALID_MAKER_ID",e[e.ZERO_ADDRESS=1001]="ZERO_ADDRESS",e[e.INVALID_NFT=1002]="INVALID_NFT",e[e.NOT_AUTHORIZED=1003]="NOT_AUTHORIZED",e[e.RECEIVER_DOES_NOT_SUPPORT_NFT=1004]="RECEIVER_DOES_NOT_SUPPORT_NFT",e[e.NFT_ALREADY_EXISTS=1005]="NFT_ALREADY_EXISTS",e[e.INVALID_INDEX=1006]="INVALID_INDEX",e[e.TRANSFERS_PAUSED=1007]="TRANSFERS_PAUSED",e[e.COIN_TRANSFER_FAILED=1008]="COIN_TRANSFER_FAILED",e[e.INVALID_SIGNATURE_KIND=1009]="INVALID_SIGNATURE_KIND",e[e.INVALID_PROXY=1010]="INVALID_PROXY",e[e.YOU_ARE_NOT_THE_TAKER=1011]="YOU_ARE_NOT_THE_TAKER",e[e.SENDER_NOT_TAKER_OR_MAKER=1012]="SENDER_NOT_TAKER_OR_MAKER",e[e.ORDER_EXPIRED=1013]="ORDER_EXPIRED",e[e.INVALID_SIGNATURE=1014]="INVALID_SIGNATURE",e[e.ORDER_CANCELED=1015]="ORDER_CANCELED",e[e.ORDER_CANNOT_BE_PERFORMED_TWICE=1016]="ORDER_CANNOT_BE_PERFORMED_TWICE",e[e.YOU_ARE_NOT_THE_MAKER=1017]="YOU_ARE_NOT_THE_MAKER",e[e.SIGNER_NOT_AUTHORIZED=1018]="SIGNER_NOT_AUTHORIZED",e[e.ONE_ZERO_ABILITY_HAS_TO_EXIST=1019]="ONE_ZERO_ABILITY_HAS_TO_EXIST",e[e.TRANSATION_RESPONSE_ERROR_CHECK_PENDING_TRANSACTIONS=2001]="TRANSATION_RESPONSE_ERROR_CHECK_PENDING_TRANSACTIONS",e[e.INVALID_ADDRESS=2002]="INVALID_ADDRESS"}(t.ConnectorIssue||(t.ConnectorIssue={}));t.ConnectorError=class extends Error{constructor(e,t){super(),this.name="ConnectorError",this.issue=e,this.original=t,this.message=`Connector error [issue: ${e}]`,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.CREATE_ASSET=1]="CREATE_ASSET",e[e.TRANSFER_ASSET=2]="TRANSFER_ASSET",e[e.TRANSFER_VALUE=3]="TRANSFER_VALUE"}(t.OrderActionKind||(t.OrderActionKind={}));t.Order=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ETH_SIGN=0]="ETH_SIGN",e[e.TREZOR=1]="TREZOR",e[e.EIP712=2]="EIP712"}(t.SignMethod||(t.SignMethod={}))},,function(e,t,n){window.zxc=window.zxc||{},window.zxc.web3=window.zxc.web3||{},window.zxc.web3={...n(7),...n(18),...n(22),...n(31)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(0);t.AssetLedgerTransferState=a.AssetLedgerTransferState,t.AssetLedgerAbility=a.AssetLedgerAbility,t.AssetLedgerCapability=a.AssetLedgerCapability,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(8))},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(9),o=n(10),s=n(11),r=n(12),u=n(13),c=n(14),d=n(15),p=n(16),l=n(17);t.AssetLedger=class{constructor(e,t){this.platform="web3",this.context=e,this.id=t,this.contract=this.getContract(t)}getAbilities(e){return a(this,void 0,void 0,function*(){return i.default(this,e)})}getCapabilities(){return a(this,void 0,void 0,function*(){return o.default(this)})}getInfo(){return a(this,void 0,void 0,function*(){return s.default(this)})}getSupply(){return a(this,void 0,void 0,function*(){return r.default(this)})}getTransferState(){return a(this,void 0,void 0,function*(){return u.default(this)})}assignAbilities(e,t){return a(this,void 0,void 0,function*(){return c.default(this,e,t)})}revokeAbilities(e,t){return a(this,void 0,void 0,function*(){return d.default(this,e,t)})}setTransferState(e){return a(this,void 0,void 0,function*(){return p.default(this,e)})}getContract(e){return new this.context.web3.eth.Contract(l.xcertAbi,e,{gas:6e6})}}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.default=function(e,t){return a(this,void 0,void 0,function*(){return e.context.query(()=>a(this,void 0,void 0,function*(){return yield Promise.all([i.AssetLedgerAbility.MANAGE_ABILITIES,i.AssetLedgerAbility.MINT_ASSET,i.AssetLedgerAbility.PAUSE_TRANSFER,i.AssetLedgerAbility.REVOKE_ASSET,i.AssetLedgerAbility.SIGN_MINT_CLAIM,i.AssetLedgerAbility.UPDATE_PROOF].map(n=>a(this,void 0,void 0,function*(){return(yield e.contract.methods.isAble(t,n).call())?n:-1}))).then(e=>e.filter(e=>-1!==e).sort())}))})}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.default=function(e){return a(this,void 0,void 0,function*(){return e.context.query(()=>a(this,void 0,void 0,function*(){return yield Promise.all([[i.AssetLedgerCapability.BURNABLE,"0x42966c68"],[i.AssetLedgerCapability.MUTABLE,"0x5e2161af"],[i.AssetLedgerCapability.PAUSABLE,"0xbedb86fb"],[i.AssetLedgerCapability.REVOKABLE,"0x20c5429b"]].map(t=>a(this,void 0,void 0,function*(){return(yield e.contract.methods.supportsInterface(t[1]).call())?t[0]:-1}))).then(e=>e.filter(e=>-1!==e).sort())}))})}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return a(this,void 0,void 0,function*(){return e.context.query(()=>a(this,void 0,void 0,function*(){return{name:yield e.contract.methods.name().call(),symbol:yield e.contract.methods.symbol().call(),uriBase:yield e.contract.methods.uriBase().call(),conventionId:yield e.contract.methods.symbol().call()}}))})}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return a(this,void 0,void 0,function*(){return e.context.query(()=>a(this,void 0,void 0,function*(){return parseInt(yield e.contract.methods.totalSupply().call())}))})}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.default=function(e){return a(this,void 0,void 0,function*(){return e.context.query(()=>a(this,void 0,void 0,function*(){return(yield e.contract.methods.isPaused().call())?i.AssetLedgerTransferState.DISABLED:i.AssetLedgerTransferState.ENABLED}))})}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return a(this,void 0,void 0,function*(){return e.context.mutate(()=>a(this,void 0,void 0,function*(){return e.contract.methods.assignAbilities(t,n)}))})}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return a(this,void 0,void 0,function*(){return e.context.mutate(()=>a(this,void 0,void 0,function*(){return e.contract.methods.revokeAbilities(t,n)}))})}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.default=function(e,t){return a(this,void 0,void 0,function*(){const n=t!==i.AssetLedgerTransferState.ENABLED;return e.context.mutate(()=>a(this,void 0,void 0,function*(){return e.contract.methods.setPause(n)}))})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.xcertAbi=JSON.parse('[{"constant":true,"inputs":[{"name":"_interfaceID","type":"bytes4"}],"name":"supportsInterface","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"_name","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_approved","type":"address"},{"name":"_tokenId","type":"uint256"}],"name":"approve","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_id","type":"uint256"},{"name":"_proof","type":"bytes32"}],"name":"mint","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_tokenId","type":"uint256"}],"name":"revoke","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_uriBase","type":"string"}],"name":"setUriBase","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_tokenId","type":"uint256"}],"name":"burn","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_index","type":"uint256"}],"name":"tokenByIndex","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_proof","type":"bytes32"}],"name":"updateTokenProof","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"conventionId","outputs":[{"name":"_conventionId","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"name":"_owner","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_target","type":"address"},{"name":"_ability","type":"uint8"}],"name":"isAble","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_target","type":"address"},{"name":"_abilities","type":"uint8[]"}],"name":"assignAbilities","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_tokenId","type":"uint256"}],"name":"tokenProof","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"_symbol","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_target","type":"address"},{"name":"_abilities","type":"uint8[]"}],"name":"revokeAbilities","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_operator","type":"address"},{"name":"_approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"isPaused","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_tokenId","type":"uint256"},{"name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_isPaused","type":"bool"}],"name":"setPause","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"uriBase","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_name","type":"string"},{"name":"_symbol","type":"string"},{"name":"_uriBase","type":"string"},{"name":"_conventionId","type":"bytes32"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"isPaused","type":"bool"}],"name":"IsPaused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_tokenId","type":"uint256"},{"indexed":false,"name":"_proof","type":"bytes32"}],"name":"TokenProofUpdate","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_target","type":"address"},{"indexed":true,"name":"_ability","type":"uint8"}],"name":"AssignAbility","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_target","type":"address"},{"indexed":true,"name":"_ability","type":"uint8"}],"name":"RevokeAbility","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"},{"indexed":true,"name":"_tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_owner","type":"address"},{"indexed":true,"name":"_approved","type":"address"},{"indexed":true,"name":"_tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_owner","type":"address"},{"indexed":true,"name":"_operator","type":"address"},{"indexed":false,"name":"_approved","type":"bool"}],"name":"ApprovalForAll","type":"event"}]')},function(e,t,n){"use strict";function a(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),a(n(19)),a(n(4))},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),o=n(20),s=n(4);t.Context=class{constructor(e){this.platform="web3",this.web3=e.web3,this.myId=e.myId,this.exchangeId=e.exchangeId||"0x",this.signMethod=this.getSignMethod(e.signMethod)}attach(){return a(this,void 0,void 0,function*(){return this.myId=yield this.getAccountId(this.myId),this})}detach(){return a(this,void 0,void 0,function*(){return this.exchangeId=null,this.myId=null,this.signMethod=null,this.web3=null,this})}sign(e){return a(this,void 0,void 0,function*(){return`${this.signMethod}:${yield this.signData(e)}`})}query(e){return a(this,void 0,void 0,function*(){try{return{result:yield e()}}catch(e){throw o.parseError(e)}})}mutate(e,t){return a(this,void 0,void 0,function*(){t=yield this.getAccountId(t||this.myId);try{const n=1.2,a=yield e();let i=yield a.estimateGas({from:t});i=new this.web3.utils.BN(1.1*i);const s=yield this.web3.eth.getGasPrice().then(e=>e*n),r=yield this.web3.eth.getBlock("latest").then(e=>e.gasLimit);if(i>r)throw"Gas exceeds max allowed gas";return yield new Promise((e,n)=>{const o=a.send({from:t,gas:i,price:s});o.once("receipt",t=>e({hash:t.transactionHash})),o.once("error",n)}).then(e=>e)}catch(e){throw o.parseError(e)}})}transfer(e,t){return a(this,void 0,void 0,function*(){t=yield this.getAccountId(t||this.myId);try{const n=1.2,{value:a,to:i}=e,s=yield this.web3.eth.estimateGas({from:t,to:i,value:a}),r=yield this.web3.eth.getGasPrice().then(e=>e*n),u=yield this.web3.eth.getBlock("latest").then(e=>e.gasLimit);if(s>u)throw"Gas exceeds max allowed gas";return yield new Promise((e,n)=>{const o=this.web3.eth.sendTransaction({from:t,to:i,value:a,gas:s,gasPrice:r});o.once("transactionHash",t=>e({hash:t})),o.once("error",n)}).then(e=>e)}catch(e){throw o.parseError(e)}})}getAccounts(){return a(this,void 0,void 0,function*(){try{return yield this.web3.eth.getAccounts()}catch(e){throw o.parseError(e)}})}getAccountId(e){return a(this,void 0,void 0,function*(){const t=yield this.getAccounts();if(void 0===e&&(e=t[0]),-1===t.indexOf(e))throw new i.ConnectorError(i.ConnectorIssue.INVALID_MAKER_ID);return e})}getSignMethod(e){if(void 0===e&&(e=s.SignMethod.ETH_SIGN),-1===[0,1,2].indexOf(e))throw new i.ConnectorError(i.ConnectorIssue.SIGNATURE_UNKNOWN,`Unknown signature method ${e}`);return e}signData(e){return a(this,void 0,void 0,function*(){try{switch(this.signMethod){case s.SignMethod.ETH_SIGN:return yield this.web3.eth.sign(e,this.myId);case s.SignMethod.TREZOR:case s.SignMethod.EIP712:return"";default:return null}}catch(e){throw new i.ConnectorError(i.ConnectorIssue.SIGNATURE_FAILED,e)}})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(0);t.ConnectorError=a.ConnectorError,t.ConnectorIssue=a.ConnectorIssue,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(21))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(0);t.parseError=function(e){if(e instanceof a.ConnectorError)return e;{const t=String(e);return t.indexOf("revert")>0?t.indexOf("003001")>0||t.indexOf("004001")>0||t.indexOf("005001")>0||t.indexOf("006001")>0||t.indexOf("018002")>0?new a.ConnectorError(a.ConnectorIssue.ZERO_ADDRESS,e):t.indexOf("003002")>0||t.indexOf("004002")>0||t.indexOf("005002")>0||t.indexOf("006002")>0||t.indexOf("010001")>0?new a.ConnectorError(a.ConnectorIssue.INVALID_NFT,e):t.indexOf("003003")>0||t.indexOf("003004")>0||t.indexOf("004003")>0||t.indexOf("004004")>0||t.indexOf("005003")>0||t.indexOf("005004")>0||t.indexOf("006003")>0||t.indexOf("006004")>0||t.indexOf("008001")>0||t.indexOf("017001")>0||t.indexOf("018001")>0||t.indexOf("019001")>0?new a.ConnectorError(a.ConnectorIssue.NOT_AUTHORIZED,e):t.indexOf("003005")>0||t.indexOf("004005")>0||t.indexOf("005005")>0||t.indexOf("006005")>0?new a.ConnectorError(a.ConnectorIssue.RECEIVER_DOES_NOT_SUPPORT_NFT,e):t.indexOf("003006")>0||t.indexOf("004006")>0||t.indexOf("005006")>0||t.indexOf("006006")>0?new a.ConnectorError(a.ConnectorIssue.NFT_ALREADY_EXISTS,e):t.indexOf("005007")>0||t.indexOf("006007")>0?new a.ConnectorError(a.ConnectorIssue.INVALID_INDEX,e):t.indexOf("009001")>0?new a.ConnectorError(a.ConnectorIssue.TRANSFERS_PAUSED,e):t.indexOf("012001")>0?new a.ConnectorError(a.ConnectorIssue.COIN_TRANSFER_FAILED,e):t.indexOf("015001")>0?new a.ConnectorError(a.ConnectorIssue.INVALID_SIGNATURE_KIND,e):t.indexOf("015002")>0?new a.ConnectorError(a.ConnectorIssue.INVALID_PROXY,e):t.indexOf("015003")>0?new a.ConnectorError(a.ConnectorIssue.YOU_ARE_NOT_THE_TAKER,e):t.indexOf("015004")>0?new a.ConnectorError(a.ConnectorIssue.SENDER_NOT_TAKER_OR_MAKER,e):t.indexOf("015005")>0?new a.ConnectorError(a.ConnectorIssue.ORDER_EXPIRED,e):t.indexOf("015006")>0?new a.ConnectorError(a.ConnectorIssue.INVALID_SIGNATURE,e):t.indexOf("015007")>0?new a.ConnectorError(a.ConnectorIssue.ORDER_CANCELED,e):t.indexOf("015008")>0?new a.ConnectorError(a.ConnectorIssue.ORDER_CANNOT_BE_PERFORMED_TWICE,e):t.indexOf("015009")>0?new a.ConnectorError(a.ConnectorIssue.YOU_ARE_NOT_THE_MAKER,e):t.indexOf("015010")>0?new a.ConnectorError(a.ConnectorIssue.SIGNER_NOT_AUTHORIZED,e):t.indexOf("017002")>0?new a.ConnectorError(a.ConnectorIssue.ONE_ZERO_ABILITY_HAS_TO_EXIST,e):new a.ConnectorError(a.ConnectorIssue.GENERAL_REVERT,e):t.indexOf("Transaction was not mined within")>0||t.indexOf("Invalid JSON RPC response")>0?new a.ConnectorError(a.ConnectorIssue.TRANSATION_RESPONSE_ERROR_CHECK_PENDING_TRANSACTIONS,e):t.indexOf("invalid address")>0||t.indexOf("is invalid, the capitalization checksum test failed, or its an indrect IBAN address which")>0||t.indexOf("Provided address is not a valid addres")>0?new a.ConnectorError(a.ConnectorIssue.INVALID_ADDRESS,e):new a.ConnectorError(a.ConnectorIssue.UNHANDLED,e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(23))},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),o=n(24),s=n(30);t.OrderExchange=class{constructor(e){this.platform="web3",this.context=e,this.contract=new e.web3.eth.Contract(s.exchangeAbi,e.exchangeId,{gas:6e6})}claim(e){return a(this,void 0,void 0,function*(){const t=this.createOrderHash(e);return yield this.context.sign(t)})}perform(e,t){return a(this,void 0,void 0,function*(){const n=this.createRecipeTuple(e),i=this.createSignatureTuple(t);return this.context.mutate(()=>a(this,void 0,void 0,function*(){return this.contract.methods.perform(n,i)}))})}cancel(e){return a(this,void 0,void 0,function*(){const t=this.createRecipeTuple(e);return this.context.myId,this.context.mutate(()=>a(this,void 0,void 0,function*(){return this.contract.methods.cancel(t)}))})}createRecipeTuple(e){const t=e.actions.map(e=>({kind:this.getHashKind(e),proxy:this.getHashProxy(e),token:o.toString(e.ledgerId),param1:this.getHashParam1(e),to:o.toString(e.receiverId),value:this.getHashValue(e)})),n={from:o.toString(e.makerId),to:o.toString(e.takerId),actions:t,seed:o.toInteger(e.seed),expirationTimestamp:o.toSeconds(e.expiration)};return o.tuple(n)}createSignatureTuple(e){const[t,n]=e.split(":"),a={r:n.substr(0,66),s:`0x${n.substr(66,64)}`,v:parseInt(`0x${n.substr(130,2)}`)+27,kind:t};return o.tuple(a)}createOrderHash(e){let t="0x0";for(const n of e.actions)t=this.context.web3.utils.soliditySha3({t:"bytes32",v:t},{t:"uint8",v:this.getHashKind(n)},{t:"uint32",v:this.getHashProxy(n)},o.toString(n.ledgerId),this.getHashParam1(n),o.toString(n.receiverId),this.getHashValue(n));return this.context.web3.utils.soliditySha3(this.context.exchangeId,o.toString(e.makerId),o.toString(e.takerId),t,o.toInteger(e.seed),o.toSeconds(e.expiration))}getHashKind(e){return e.kind===i.OrderActionKind.CREATE_ASSET?0:1}getHashProxy(e){return e.kind===i.OrderActionKind.TRANSFER_VALUE?1:e.kind===i.OrderActionKind.TRANSFER_ASSET?3:0}getHashParam1(e){return e.kind===i.OrderActionKind.CREATE_ASSET?e.assetProof:this.context.web3.utils.padLeft(o.toString(e.senderId),64)}getHashValue(e){return e.assetId||o.toFloat(e.value)}}},function(e,t,n){"use strict";function a(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),a(n(25)),a(n(26)),a(n(27)),a(n(28)),a(n(29))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toFloat=function(e){return parseFloat(`${e}`)||0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toInteger=function(e){return parseInt(`${e}`)||0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toSeconds=function(e){return parseInt(`${parseFloat(`${e}`)/1e3}`)||0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toString=function(e){return null!==e&&void 0!==e?e.toString():null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tuple=function e(t){if(!(t instanceof Object))return[];var n=[],a=0;return Object.keys(t).forEach(i=>{if(t[i]instanceof Object)n[a]=e(t[i]);else if(t[i]instanceof Array){let o=0,s=[];t[i].forEach(n=>{s[o]=e(t[i]),o++}),n[a]=s}else n[a]=t[i];a++}),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exchangeAbi=JSON.parse('[{"constant":false,"inputs":[{"components":[{"name":"maker","type":"address"},{"name":"taker","type":"address"},{"components":[{"name":"kind","type":"uint8"},{"name":"proxy","type":"uint32"},{"name":"token","type":"address"},{"name":"param1","type":"bytes32"},{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"actions","type":"tuple[]"},{"name":"seed","type":"uint256"},{"name":"expiration","type":"uint256"}],"name":"_data","type":"tuple"}],"name":"cancel","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"orderCancelled","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_target","type":"address"},{"name":"_ability","type":"uint8"}],"name":"isAble","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_target","type":"address"},{"name":"_abilities","type":"uint8[]"}],"name":"assignAbilities","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"components":[{"name":"maker","type":"address"},{"name":"taker","type":"address"},{"components":[{"name":"kind","type":"uint8"},{"name":"proxy","type":"uint32"},{"name":"token","type":"address"},{"name":"param1","type":"bytes32"},{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"actions","type":"tuple[]"},{"name":"seed","type":"uint256"},{"name":"expiration","type":"uint256"}],"name":"_data","type":"tuple"},{"components":[{"name":"r","type":"bytes32"},{"name":"s","type":"bytes32"},{"name":"v","type":"uint8"},{"name":"kind","type":"uint8"}],"name":"_signature","type":"tuple"}],"name":"perform","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_signer","type":"address"},{"name":"_claim","type":"bytes32"},{"components":[{"name":"r","type":"bytes32"},{"name":"s","type":"bytes32"},{"name":"v","type":"uint8"},{"name":"kind","type":"uint8"}],"name":"_signature","type":"tuple"}],"name":"isValidSignature","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":false,"inputs":[{"name":"_target","type":"address"},{"name":"_abilities","type":"uint8[]"}],"name":"revokeAbilities","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"components":[{"name":"maker","type":"address"},{"name":"taker","type":"address"},{"components":[{"name":"kind","type":"uint8"},{"name":"proxy","type":"uint32"},{"name":"token","type":"address"},{"name":"param1","type":"bytes32"},{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"actions","type":"tuple[]"},{"name":"seed","type":"uint256"},{"name":"expiration","type":"uint256"}],"name":"_orderData","type":"tuple"}],"name":"getOrderDataClaim","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"orderPerformed","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint32"},{"name":"_proxy","type":"address"}],"name":"setProxy","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint32"}],"name":"idToProxy","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_maker","type":"address"},{"indexed":true,"name":"_taker","type":"address"},{"indexed":false,"name":"_claim","type":"bytes32"}],"name":"Perform","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_maker","type":"address"},{"indexed":true,"name":"_taker","type":"address"},{"indexed":false,"name":"_claim","type":"bytes32"}],"name":"Cancel","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_id","type":"uint32"},{"indexed":false,"name":"_proxy","type":"address"}],"name":"ProxyChange","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_target","type":"address"},{"indexed":true,"name":"_ability","type":"uint8"}],"name":"AssignAbility","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_target","type":"address"},{"indexed":true,"name":"_ability","type":"uint8"}],"name":"RevokeAbility","type":"event"}]')},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(32))},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(33),o=n(34),s=n(35);t.ValueLedger=class{constructor(e,t){this.platform="web3",this.context=e,this.id=t,this.contract=this.getContract(t)}getInfo(){return a(this,void 0,void 0,function*(){return i.default(this)})}getSupply(){return a(this,void 0,void 0,function*(){return o.default(this)})}getContract(e){return new this.context.web3.eth.Contract(s.tokenAbi,e,{gas:6e6})}}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return a(this,void 0,void 0,function*(){return e.context.query(()=>a(this,void 0,void 0,function*(){return{name:yield e.contract.methods.name().call(),symbol:yield e.contract.methods.symbol().call(),decimals:parseInt(yield e.contract.methods.decimals().call())}}))})}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function s(e){try{u(a.next(e))}catch(e){o(e)}}function r(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,r)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return a(this,void 0,void 0,function*(){return e.context.query(()=>a(this,void 0,void 0,function*(){return parseInt(yield e.contract.methods.totalSupply().call())}))})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tokenAbi=JSON.parse('[{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"_name","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"_success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"_totalSupply","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"_success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"_decimals","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"_balance","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"_symbol","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"_success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"_remaining","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_owner","type":"address"},{"indexed":true,"name":"_spender","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"Approval","type":"event"}]')}]);