!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){window.$0xcert=window.$0xcert||{},window.$0xcert.client=n(1)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(2))},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function u(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(o,u)}c((i=i.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const r=n(3),s=n(12);e.Client=class{constructor(t){this.connector=t.connector}sign(t){return i(this,void 0,void 0,function*(){return this.connector.sign(t)})}getMutation(t){return i(this,void 0,void 0,function*(){return this.connector.getMutation(t)})}getOrderExchange(t=null){return i(this,void 0,void 0,function*(){return this.connector.getOrderExchange(t)})}getAssetLedger(t){return i(this,void 0,void 0,function*(){return this.connector.getAssetLedger(t)})}getValueLedger(t){return i(this,void 0,void 0,function*(){return this.connector.getValueLedger(t)})}createQueue(t){return null}createCert(t){return new r.Cert(t)}createMutationTracker(){return new s.MutationTracker(this.connector)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(4))},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function u(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(o,u)}c((i=i.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const r=n(5),s=n(9),o=n(11);e.Cert=class{constructor(t){this.schema=t.schema,this.merkle=new s.Merkle(Object.assign({hasher:t=>r.sha256(o.toString(t))},t))}notarize(t){return i(this,void 0,void 0,function*(){const e=this.buildSchemaProps(t),n=yield this.buildCompoundProps(e);return(yield this.buildProofs(n)).map(t=>({path:t.path,nodes:t.nodes,values:t.values}))})}disclose(t,e){return i(this,void 0,void 0,function*(){const n=this.buildSchemaProps(t),i=yield this.buildCompoundProps(n);return(yield this.buildProofs(i,e)).map(t=>({path:t.path,nodes:t.nodes,values:t.values}))})}calculate(t,e){return i(this,void 0,void 0,function*(){try{return this.checkDataInclusion(t,e)?this.imprintProofs(e):null}catch(t){return null}})}imprint(t){return i(this,void 0,void 0,function*(){return this.notarize(t).then(t=>t[0].nodes[0].hash)})}buildSchemaProps(t,e=this.schema,n=[]){return"array"===e.type?(t||[]).map((t,i)=>this.buildSchemaProps(t,e.items,[...n,i])).reduce((t,e)=>t.concat(e),[]):"object"===e.type?Object.keys(e.properties).sort().map(i=>{const r=this.buildSchemaProps((t||{})[i],e.properties[i],[...n,i]);return-1===["object","array"].indexOf(e.properties[i].type)?[r]:r}).reduce((t,e)=>t.concat(e),[]):{path:n,value:t,key:n.join("."),group:n.slice(0,-1).join(".")}}buildCompoundProps(t){return i(this,void 0,void 0,function*(){t=[...t];const e=this.buildPropGroups(t),n=Object.keys(e).sort((t,e)=>t>e?-1:1).filter(t=>""!==t);for(const i of n){const n=e[i],r=[...t.filter(t=>t.group===i)].sort((t,e)=>t.key>e.key?1:-1).map(t=>t.value),s=yield this.merkle.notarize(r);t.push({path:n,value:s.nodes[0].hash,key:n.join("."),group:n.slice(0,-1).join(".")})}return t.sort((t,e)=>t.key>e.key?1:-1)})}buildProofs(t,e=null){return i(this,void 0,void 0,function*(){const n=e?o.stepPaths(e).map(t=>t.join(".")):null,r={};return t.forEach(t=>r[t.group]=t.path.slice(0,-1)),Promise.all(Object.keys(r).map(e=>i(this,void 0,void 0,function*(){const i=t.filter(t=>t.group===e).map(t=>t.value);let s=yield this.merkle.notarize(i);if(n){const i=t.filter(t=>t.group===e).map((t,e)=>-1===n.indexOf(t.key)?-1:e).filter(t=>-1!==t);s=yield this.merkle.disclose(s,i)}if(!n||-1!==n.indexOf(r[e].join(".")))return{path:r[e],values:s.values,nodes:s.nodes,key:r[e].join("."),group:r[e].slice(0,-1).join(".")}}))).then(t=>t.filter(t=>!!t))})}checkDataInclusion(t,e){const n=this.buildSchemaProps(t);e=o.cloneObject(e).map(t=>Object.assign({key:t.path.join("."),group:t.path.slice(0,-1).join(".")},t));for(const i of n){const n=o.readPath(i.path,t);if(void 0===n)continue;const r=i.path.slice(0,-1).join("."),s=e.find(t=>t.key===r);if(!s)return!1;const u=this.getPathIndexes(i.path).pop();if(s.values.find(t=>t.index===u).value!==n)return!1}return!0}imprintProofs(t){return i(this,void 0,void 0,function*(){if(0===t.length)return this.getEmptyImprint();t=o.cloneObject(t).map(t=>Object.assign({key:t.path.join("."),group:t.path.slice(0,-1).join(".")},t)).sort((t,e)=>t.path.length>e.path.length?-1:1);for(const e of t){const n=yield this.merkle.imprint(e).catch(()=>"");e.nodes.unshift({index:0,hash:n});const i=e.path.slice(0,-1).join("."),r=this.getPathIndexes(e.path).slice(-1).pop(),s=t.find(t=>t.key===i);s&&s.values.unshift({index:r,value:n})}const e=t.find(t=>""===t.key);return e?e.nodes.find(t=>0===t.index).hash:this.getEmptyImprint()})}getPathIndexes(t){const e=[];let n=this.schema;for(const i of t)"array"===n.type?(e.push(i),n=n.items):"object"===n.type?(e.push(Object.keys(n.properties).sort().indexOf(i)),n=n.properties[i]):e.push(void 0);return e}getEmptyImprint(){return i(this,void 0,void 0,function*(){return this.merkle.notarize([]).then(t=>t.nodes[0].hash)})}buildPropGroups(t){const e={};return t.map(t=>{let e=[];return t.path.map(t=>(e.push(t),[...e]))}).reduce((t,e)=>t.concat(e),[]).forEach(t=>e[t.slice(0,-1).join(".")]=t.slice(0,-1)),e}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(6))},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function u(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(o,u)}c((i=i.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const r=n(7);e.sha256=function(t){return i(this,void 0,void 0,function*(){return r.sha(256,t)})}},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function u(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(o,u)}c((i=i.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.sha=function(t,e){return i(this,void 0,void 0,function*(){if("undefined"!=typeof window){const n=new window.TextEncoder("utf-8").encode(e),i=yield window.crypto.subtle.digest(`SHA-${t}`,n);return Array.from(new Uint8Array(i)).map(t=>("00"+t.toString(16)).slice(-2)).join("")}return n(8).createHash(`sha${t}`).update(e).digest("hex")})}},function(t,e){t.exports=void 0},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(10))},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function u(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(o,u)}c((i=i.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});e.Merkle=class{constructor(t){this.config=Object.assign({hasher:t=>t},t)}notarize(t){return i(this,void 0,void 0,function*(){const e=[...t],n=[yield this.config.hasher("")];for(let t=e.length-1;t>=0;t--){const i=n[0],r=e[t];n.unshift(yield this.config.hasher(r));const s=n[0];n.unshift(yield this.config.hasher(`${s}${i}`))}return{values:e.map((t,e)=>({index:e,value:t})),nodes:n.map((t,e)=>({index:e,hash:t}))}})}disclose(t,e){return i(this,void 0,void 0,function*(){const n=Math.max(...e.map(t=>t+1),0),i=[],r=[t.nodes.find(t=>t.index===2*n)];for(let s=n-1;s>=0;s--)-1!==e.indexOf(s)?i.unshift(t.values.find(t=>t.index===s)):r.unshift(t.nodes.find(t=>t.index===2*s+1));return{values:i,nodes:r}})}imprint(t){return i(this,void 0,void 0,function*(){const e=[...yield Promise.all(t.values.map(t=>i(this,void 0,void 0,function*(){return{index:2*t.index+1,hash:yield this.config.hasher(t.value),value:t.value}}))),...t.nodes];for(let t=Math.max(...e.map(t=>t.index+1),0)-1;t>=0;t-=2){const n=e.find(e=>e.index===t),i=e.find(e=>e.index===t-1);n&&i&&e.unshift({index:t-2,hash:yield this.config.hasher(`${i.hash}${n.hash}`)})}const n=e.find(t=>0===t.index);return n?n.hash:null})}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.toString=function(t){try{return null==t?"":`${t}`}catch(t){return""}},e.cloneObject=function(t){return JSON.parse(JSON.stringify(t))},e.stepPaths=function(t){const e={"":[]};return t.forEach(t=>{let n=[];t.forEach(t=>{n.push(t),e[n.join(".")]=[...n]})}),Object.keys(e).sort().map(t=>e[t])},e.readPath=function t(e,n){try{return Array.isArray(e)?0===e.length?n:t(e.slice(1),n[e[0]]):void 0}catch(t){return}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(13))},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function u(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(o,u)}c((i=i.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const r=n(14);!function(t){t.CONFIRM="confirm",t.COMPLETE="complete",t.REMOVE="remove",t.TICK="tick"}(e.MutationEvent||(e.MutationEvent={}));e.MutationTracker=class extends r.EventEmitter{constructor(t){super(),this.transactions={},this.timer=null,this.running=!1,this.connector=t}on(t,e){return super.on(t,e)}off(t,e){return e?super.off(t,e):super.removeAllListeners(t)}isRunning(){return this.running}add(...t){return t.forEach(t=>{void 0===this.transactions[t]&&(this.transactions[t]=0)}),this}remove(...t){return t.forEach(t=>{delete this.transactions[t]}),this}check(t){return i(this,void 0,void 0,function*(){return this.connector.getMutation(t)})}clear(){return this.transactions={},this}start(){return this.running=!0,this.loop(0),this}stop(){return this.running=!1,this.suspend(),this}tick(){return i(this,void 0,void 0,function*(){this.emit("tick");for(const t in this.transactions){const e=yield this.connector.getMutation(t),n=this.transactions[t];e?(!n||e.confirmations>n)&&(this.transactions[t]=e.confirmations,this.emit("confirm",e)):this.emit("remove",{id:t,confirmations:0}),e.confirmations>=2&&(this.emit("complete",e),delete this.transactions[t])}this.loop(5e3)})}loop(t){this.suspend(),this.timer=setTimeout(this.tick.bind(this),t)}suspend(){this.timer&&(clearTimeout(this.timer),this.timer=null)}}},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function r(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,o,u,c,h;if(this._events||(this._events={}),"error"===t&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var a=new Error('Uncaught, unspecified "error" event. ('+e+")");throw a.context=e,a}if(s(n=this._events[t]))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),n.apply(this,u)}else if(r(n))for(u=Array.prototype.slice.call(arguments,1),o=(h=n.slice()).length,c=0;c<o;c++)h[c].apply(this,u);return!0},n.prototype.addListener=function(t,e){var o;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?r(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,r(this._events[t])&&!this._events[t].warned&&(o=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[t].length>o&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){if(!i(e))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(t,r),n||(n=!0,e.apply(this,arguments))}return r.listener=e,this.on(t,r),this},n.prototype.removeListener=function(t,e){var n,s,o,u;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(o=(n=this._events[t]).length,s=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(r(n)){for(u=o;u-- >0;)if(n[u]===e||n[u].listener&&n[u].listener===e){s=u;break}if(s<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}}]);